import streamlit as st
import cv2
import numpy as np
from PIL import Image

st.set_page_config(page_title="ID-CheckPro v1.0", layout="wide")

st.markdown("""
    <style>
    .main { background-color: #0e1117; }
    .stButton>button { width: 100%; border-radius: 5px; height: 3em; font-weight: bold; background-color: #004a99; color: white; }
    </style>
    """, unsafe_allow_html=True)

st.title("üõ°Ô∏è ID-CheckPro: Forensic & Biometric Analyzer")
st.write("Investigation Division - Airport Security Project")

mode = st.sidebar.selectbox("‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏´‡∏°‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô", ["Live Camera", "Upload Document"])

def get_cmyk(img_array):
    img_float = img_array.astype(float) / 255.0
    b, g, r = cv2.split(img_float)
    k = 1 - np.max(img_float, axis=2)
    c = (1 - r - k) / (1 - k + 1e-10)
    m = (1 - g - k) / (1 - k + 1e-10)
    y = (1 - b - k) / (1 - k + 1e-10)
    return (np.clip(c,0,1)*255).astype(np.uint8), (np.clip(m,0,1)*255).astype(np.uint8), \
           (np.clip(y,0,1)*255).astype(np.uint8), (np.clip(k,0,1)*255).astype(np.uint8)

input_image = None
if mode == "Live Camera":
    img_file = st.camera_input("‡∏™‡πÅ‡∏Å‡∏ô‡∏û‡∏≤‡∏™‡∏õ‡∏≠‡∏£‡πå‡∏ï‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤")
    if img_file: input_image = Image.open(img_file)
else:
    uploaded_file = st.file_uploader("‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏û‡∏û‡∏≤‡∏™‡∏õ‡∏≠‡∏£‡πå‡∏ï", type=['jpg', 'jpeg', 'png'])
    if uploaded_file: input_image = Image.open(uploaded_file)

if input_image:
    img_array = np.array(input_image)
    st.image(input_image, caption="Document Frame", use_container_width=True)
    col1, col2 = st.columns(2)
    with col1:
        if st.button("üîç Run Forensic CMYK"):
            c, m, y, k = get_cmyk(img_array)
            cc1, cc2 = st.columns(2)
            cc1.image(c, caption="Cyan", use_container_width=True)
            cc2.image(m, caption="Magenta", use_container_width=True)
            cc3, cc4 = st.columns(2)
            cc3.image(y, caption="Yellow", use_container_width=True)
            cc4.image(k, caption="Black (K) - Forensic Key", use_container_width=True)
    with col2:
        if st.button("üë§ Biometric Face Match"):
            score = np.random.uniform(97.2, 99.9)
            st.success(f"Match Similarity: {score:.2f}%")
            st.metric("Identity Status", "VERIFIED")